\chapter{Model and Analysis}
First, we specify some sorts with which we can then define the global type.
Afterwards, we define the processes for the proposer and the acceptor.
Finally, we will study an example run of the model.

\subsection{Sorts}
\newcommand{\Maybe}[1]{\operatorname{Maybe}\; #1}
\newcommand{\Just}[1]{\operatorname{Just}\; #1}
\newcommand{\Nothing}[0]{\operatorname{Nothing}}
\newcommand{\Or}[0]{\; | \;}
\newcommand{\Promise}[1]{\operatorname{Promise}\; #1}
\newcommand{\Proposal}[1]{\operatorname{Proposal}\; #1}
\newcommand{\ProposalC}[2]{\operatorname{Proposal}\; #1\; #2}
\newcommand{\Nack}[1]{\operatorname{Nack}\; #1}
\newcommand{\Value}[0]{\operatorname{Value}}

\newcommand{\Sort}[1]{\left\{#1\right\}}
\newcommand{\Paren}[1]{\left(#1\right)}

We assume the following sorts.

$\Maybe{a} = \Sort{\Just{a}, \Nothing}$

$\Value =$ Set of values.

$\Promise{a} = \Sort{\Promise{\Paren{\Maybe{\Paren{\Proposal{a}}}}}, \Nack{\mathbb{N}}}$

$\Proposal{a} = \Sort{\ProposalC{\mathbb{N}}{a}}$

\subsection{Global Type}
\newcommand{\DotForall}[1]{\bigodot_{#1}\;}
\newcommand{\SendUnreliableG}[4]{#1 \to_u #2 : #3 \left\langle #4 \right\rangle}
\newcommand{\SendWeaklyG}[3]{#1 \to_w #2 : #3}

\newcommand{\Accept}[0]{\mathnormal{Accept}}
\newcommand{\Restart}[0]{\mathnormal{Restart}}
\newcommand{\Abort}[0]{\mathnormal{Abort}}

\newcommand{\Mu}[1]{\left(\mu #1\right)}

Since each proposer initiates its own session the global type can be defined for one proposer.
A quorum of acceptors $A_Q$ is assumed.

The last phase of Paxos contains no inter-process communication, so it is not modeled in the global type.

$G_{p, A_Q} = \Mu{X} \DotForall{a \in A_Q} \SendUnreliableG{p}{a}{l1a}{\mathbb{N}} . \DotForall{a \in A_Q} \SendUnreliableG{a}{p}{l1b}{\Promise{\Value}} .\\
\hspace*{0.5em}\SendWeaklyG{p}{A_Q}{\Accept.\Paren{\DotForall{a \in A_Q} \SendUnreliableG{p}{a}{l2a}{\Proposal{\Value}}}.end\\
\hspace*{1em}\oplus \Restart.X\\
\hspace*{1em}\oplus \Abort.end}$

We can distinguish the individual phases of the Paxos algorithm by the labels $l1a$, $l1b$, and $l2a$.

In the first two steps, $1a$ and $1b$, the proposer sends its proposal number to each acceptor in $A_Q$ and listens for their responses.
In step 2a the proposer decides whether to send an $\Accept$ or $\Restart$ message to restart the algorithm.
This decision is broadcast to all acceptors in $A_Q$.
Should the proposer crash the algorithm ends for this particular proposer and quorum of acceptors.

\subsection{Functions and Sets}
\newcommand{\Bool}[0]{\operatorname{Bool}}
\newcommand{\True}[0]{\operatorname{true}}
\newcommand{\False}[0]{\operatorname{false}}
\newcommand{\prNumber}[2]{\operatorname{prNumber}\left( #1, #2 \right)}
\newcommand{\promValue}[1]{\operatorname{promValue}\left(#1\right)}
\newcommand{\anyNack}[1]{\operatorname{anyNack}\left(#1\right)}
\newcommand{\promCount}[1]{\operatorname{promCount}\left(#1\right)}
\newcommand{\greaterThan}[2]{\operatorname{gt}\left(#1, #2\right)}
\newcommand{\greaterEqual}[2]{\operatorname{ge}\left(#1, #2\right)}
\newcommand{\nFromPr}[1]{\operatorname{nFromPr}\left(#1 \right)}
\newcommand{\genAq}[3]{\operatorname{genA_Q}\left(#1, #2, #3\right)}

$\Bool = \Sort{\True, \False}$

$\operatorname{prNumber} : \mathbb{N} \times \mathbb{N} \to \mathbb{N}$ returns a proposal number when given two natural numbers.

$\operatorname{promValue} : [\Promise{a}] \to a$ if none of the promises in the given list contain a value a new value is returned.
A promise contains a value if it is of the form $\Promise{(\Just{v})}$.
$v$ is the value.

$\operatorname{anyNack} : [\Promise{a}] \to \Bool\\
\anyNack{[]} = false\\
\anyNack{\Paren{\Nack{\_}: \_}} = true\\
\anyNack{\Paren{\_:xs}} = \anyNack{xs}$

$\operatorname{promCount} : [\Promise{a}] \to \mathbb{N}\\
\promCount{[]} = 0\\
\promCount{\Paren{\Promise{\_}:xs}} = 1 + \promCount{xs}\\
\promCount{\Paren{\_:xs}} = \promCount{xs}$

$\operatorname{gt}: a \to \Maybe{a} \to \Bool\\
\greaterThan{\_}{\Nothing} = true\\
\greaterThan{a}{\Just{b}} = a > b$

$\operatorname{ge}: a \to \Maybe{a} \to \Bool\\
\greaterEqual{\_}{\Nothing} = true\\
\greaterEqual{a}{\Just{b}} = a \ge b$

$\operatorname{nFromPr} : \Proposal{a} \to \mathbb{N}\\
\nFromPr{\ProposalC{n}{\_}} = n$

$\genAq{i}{ac}{pc}$ returns a set $A_Q$ with $A_Q \subseteq A = \{1, \dots, ac\}$ and $|A_Q| > \frac{|A|}{2}$.

\subsection{Processes}
\newcommand{\Sys}[2]{\operatorname{Sys}\left(#1, #2\right)}
\newcommand{\Pa}[0]{\operatorname{P^a}}
\newcommand{\Pp}[0]{\operatorname{P^p}}
\newcommand{\PaCont}[0]{\operatorname{P^a_{cont}}}

\newcommand{\PpInit}[5]{\operatorname{P^p_{init}}\left(#1, #2, #3, #4, #5\right)}
\newcommand{\PaInit}[6]{\operatorname{P^a_{init}}\left(#1, #2, #3, #4, #5, #6\right)}

\subsubsection{System Initialization}
\newcommand{\SessionRequest}[3]{\overline{#1}\left[#2\right]\left(#3\right)}
\newcommand{\SessionAccept}[3]{#1\left[#2\right]\left(#3\right)}
\newcommand{\ParallelFor}[1]{\Pi_{#1}\;}
\newcommand{\VectorV}[0]{\overrightarrow{V}}

% Idea: One shared-point per Proposer over which the session is initialized.
$\Sys{ac}{pc} = \SessionRequest{a}{2}{t} . \PpInit{ac + 1}{\genAq{ac + pc}{ac}{pc}}{ac + pc}{ac + pc}{[]}\\
\Or \SessionAccept{a}{1}{t} . \ParallelFor{ac < i < ac + pc} \PpInit{ac + 1}{\genAq{i}{ac}{pc}}{i}{i}{[]} \\
\Or \ParallelFor{1 \le j \le ac} \PaInit{j}{ac + 1}{ac}{pc}{n_j}{pr_j}$

$\PpInit{i}{A_Q}{n}{m}{\VectorV} = \SessionRequest{b_n}{i}{s} . \Pp$

$\PaInit{j}{i}{ac}{pc}{n}{pr} = \ParallelFor{ac < k \le ac + pc} \SessionAccept{b_k}{j}{s} . \Pa$

$\Sys{ac}{pc}$, $\PpInit{i}{A_Q}{n}{m}{\VectorV}$, and $\PaInit{j}{i}{ac}{pc}{n}{pr}$ describe the system initialization.
$ac$ and $pc$ are the number of acceptors and proposers respectively.

An outer session is created through shared-point $a$.
This outer session is not strictly necessary but was left in to allow for easier extension of the model.
The acceptors are initialized using indices from 1 to $ac$ and the proposers are initialized using indices from $ac + 1$ to $ac + pc$.

$\PpInit{i}{A_Q}{n}{m}{\VectorV}$ is initialized with the proposer's role in its own session $i$, which is always $ac + 1$, a quorum of acceptors $A_Q$, an index $n$, and a vector $\VectorV$.
Each proposer has the same role $i = ac + 1$ but uses a different shared-point $b_n$ according to its index $n$.
$\VectorV$ is used in the proposer to collect and evaluate the responses from the acceptors.
It is always initialized with an empty list $[]$.
Shared-point $b_n$ is used to initiate a session.
Afterwards, the process behaves like $\Pp$.

$\PaInit{j}{i}{ac}{pc}{n}{pr}$ is initialized with the acceptor's index $j$, the proposer index $i$, which is always $ac + 1$, $ac$, $pc$, initial knowledge for the highest promised proposal number $n$, if available, and initial knowledge for the most recently accepted proposal $pr$, if available.
$n$ is of type $\Maybe{\mathbb{N}}$ and $pr$ is of type $\Maybe{\Paren{\Proposal{\Value}}}$ thus both can be $\Nothing$.
Each of the proposers' session requests are accepted in a separate subprocess.
These subprocesses run parallel to each other but still access the same values for $n$ and $pr$.
Afterwards, each subprocess behaves like $\Pa$.

\subsubsection{Proposer}
\newcommand{\SendUnreliableP}[5]{#1\left[#2, #3\right]!_u #4 \left\langle #5 \right\rangle}
\newcommand{\ReceiveUnreliableP}[6]{#1\left[#2, #3\right]?_u #4 \left\langle #5 \right\rangle \left(#6\right)}
\newcommand{\ceil}[1]{\Big\lceil #1 \Big\rceil}
\newcommand{\SendWeaklyP}[5]{#1\left[#2, #3\right]!_w #4.#5}
\newcommand{\ReceiveWeaklyP}[4]{#1\left[#2, #3\right]?_w #4}
\newcommand{\If}[1]{\operatorname{if}\; #1}
\newcommand{\Then}[1]{\operatorname{then}\; #1}
\newcommand{\Else}[1]{\operatorname{else}\; #1}
\newcommand{\update}[2]{\operatorname{update} \left(#1, #2\right)}
\newcommand{\tOr}[0]{\text{ or }}

$\Pp = \Mu{X} \update{n}{n + 1} . \left(\DotForall{j \in A_Q} \SendUnreliableP{s}{i}{j}{l1a}{\prNumber{n}{m}}\right) .\\
\hspace*{0.5em}\left(\DotForall{j \in A_Q} \ReceiveUnreliableP{s}{j}{i}{l1b}{\perp}{v_j}\right) .\\
\hspace*{0.5em}\If{\anyNack{\VectorV} \tOr \promCount{\VectorV} < \ceil{\frac{|A_Q|}{2}}}\\
\hspace*{1em}\Then{\SendWeaklyP{s}{i}{A_Q}{\Restart}{X}}\\
\hspace*{1em}\Else{\\\hspace*{1.5em}\SendWeaklyP{s}{i}{A_Q}{\Accept}{\DotForall{j \in A_Q} \SendUnreliableP{s}{i}{j}{l2a}{\ProposalC{\prNumber{n}{i}}{\promValue{\VectorV}}}.\\\hspace*{1.5em}end}}$

\subsubsection{Acceptor}
$\Pa = \Mu{X} \ReceiveUnreliableP{s}{i}{j}{l1a}{\perp}{n'} .\\
\hspace*{0.5em}\If{n' = \perp}\\
\hspace*{1em}\Then{\PaCont}\\
\hspace*{1em}\Else{\\
\hspace*{1.5em}\If{\greaterThan{n'}{n}}\\
\hspace*{1.5em}\Then{\update{n}{n'}.\SendUnreliableP{s}{j}{i}{l1b}{\Promise{pr}}.\PaCont}\\
\hspace*{1.5em}\Else{\SendUnreliableP{s}{j}{i}{l1b}{\Nack{n}}.\PaCont}}$

$\PaCont = \ReceiveWeaklyP{s}{i}{j}{\Accept . \ReceiveUnreliableP{s}{i}{j}{l2a}{\perp}{pr'} .\\
\hspace*{1em}\If{pr' = \perp}\\
\hspace*{1.5em}\Then{X}\\
\hspace*{1.5em}\Else{\\
\hspace*{2em}\If{\greaterEqual{\nFromPr{pr'}}{n}}\\
\hspace*{2.5em}\Then{\update{pr}{pr'} . \update{n}{\Just{\nFromPr{pr'}}}.X}\\
\hspace*{2.5em}\Else{X}}\\
\hspace*{0.5em} \oplus \Restart.X\\
\hspace*{0.5em} \oplus \Abort.end}$

\section{Example}
\newcommand{\Nu}[1]{\left(\nu #1\right)}
\newcommand{\OuterSessionQueues}[0]{\ParallelFor{1 \le k,l \le 2, k \neq l} t_{k\to l}:[]}
\newcommand{\InnerSessionQueues}[1]{\ParallelFor{1 \le k,l \le 4, k \neq l} #1_{k\to l}:[]}
\newcommand{\NuChannels}[0]{\Nu{t}\Nu{s}\Nu{r}}

$ac = 3\; pc = 2$

$\Sys{3}{2} =
\SessionAccept{a}{1}{t}.\ParallelFor{3 < i < 5} \PpInit{4}{\genAq{i}{3}{2}}{i}{i}{[]}\\
\Or \SessionRequest{a}{2}{t}.\PpInit{4}{\genAq{5}{3}{2}}{5}{5}{[]}\\
\Or \ParallelFor{1 \le j \le 3} \PaInit{j}{4}{3}{2}{n_j}{pr_j}\\
\longmapsto (\operatorname{Init})\\
\Nu{t}\big (
\PpInit{4}{A_{Q,1}}{4}{4}{[]} \Or \PpInit{4}{A_{Q,2}}{5}{5}{[]}\\
\Or \PaInit{1}{4}{3}{2}{n_1}{pr_1} \Or \PaInit{2}{4}{3}{2}{n_2}{pr_2} \Or \PaInit{3}{4}{3}{2}{n_3}{pr_3}\\
\Or \OuterSessionQueues
\big )$

$=\\
% Is this step really necessary?
\Nu{t}\big (
\SessionRequest{b_4}{4}{s}.\Pp \Or \SessionRequest{b_5}{4}{r}.\Pp\\
\Or \ParallelFor{3 < n \le 5} \SessionAccept{b_n}{1}{s} . \Pa\\
\Or \ParallelFor{3 < n \le 5} \SessionAccept{b_n}{2}{s} . \Pa\\
\Or \ParallelFor{3 < n \le 5} \SessionAccept{b_n}{3}{s} . \Pa\\
\Or \OuterSessionQueues
\big )\\
=\\
\Nu{t}\big (
\SessionRequest{b_4}{4}{s}.\Pp \Or \SessionRequest{b_5}{4}{r}.\Pp\\
\Or \Paren{\SessionAccept{b_4}{1}{s}.\Pa \Or \SessionAccept{b_5}{1}{r}.\Pa}\\
\Or \Paren{\SessionAccept{b_4}{2}{s}.\Pa \Or \SessionAccept{b_5}{2}{r}.\Pa}\\
\Or \Paren{\SessionAccept{b_4}{3}{s}.\Pa \Or \SessionAccept{b_5}{3}{r}.\Pa}\\
\Or \OuterSessionQueues
\big )$

$\longmapsto (Init)\\
\NuChannels\big (
\Mu{X} \update{n}{5} . \Paren{\DotForall{j\in \{1,2\}} \SendUnreliableP{s}{4}{j}{l1a}{\prNumber{n}{4}}}\dots\\
\Or \Mu{X} \update{n}{6} . \Paren{\DotForall{j\in \{2,3\}} \SendUnreliableP{r}{4}{j}{l1a}{\prNumber{n}{5}}}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels\big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{2}{l1a}{\prNumber{6}{5}}.\SendUnreliableP{r}{4}{3}{l1a}{\prNumber{6}{5}}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{3}{l1a}{\prNumber{6}{5}}.\ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{10 = \perp} \Then{\PaCont} \Else{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{3}{l1a}{\prNumber{6}{5}}.\ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{\greaterThan{10}{\Nothing}} \Then{\update{n}{n'}\dots} \Else{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=Nothing, pr=Nothing
% A2: n=10, pr=Nothing
% A3: n=Nothing, pr=Nothing
$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{3}{l1a}{\prNumber{6}{5}}.\ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{2}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=Nothing, pr=Nothing
% A2: n=10, pr=Nothing
% A3: n=10, pr=Nothing
$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}.\ReceiveUnreliableP{r}{3}{4}{l1b}{\perp}{v_3}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{2}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{3}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USkip)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}.\ReceiveUnreliableP{r}{3}{4}{l1b}{\perp}{v_3}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{\perp = \perp} \Then{\PaCont} \Else{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{2}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{3}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{r}{2}{4}{l1b}{\perp}{v_2}.\ReceiveUnreliableP{r}{3}{4}{l1b}{\perp}{v_3}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{1}{\Accept \dots \oplus \Restart .X \oplus \Abort .end}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{2}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{3}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

\newcommand{\BeginPaCont}[0]{\Accept \dots \oplus \Restart .X \oplus \Abort .end}
$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{r}{3}{4}{l1b}{\perp}{v_3}.\If{\anyNack{\VectorV} \tOr \promCount{\VectorV} < 1} \Then{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{1}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{2}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \SendUnreliableP{r}{3}{4}{l1b}{\Promise{\Nothing}}.\PaCont
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \If{\False \tOr 2 < 1} \Then{\dots} \Else{\SendWeaklyP{r}{4}{\Sort{2,3}}{\Accept}{\dots}}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{1}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{2}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendWeaklyP{r}{4}{\Sort{2,3}}{\Accept}{\SendUnreliableP{r}{4}{2}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{1}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{2}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (WSel + WBran)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{2}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}.\\\hspace*{1em}\SendUnreliableP{r}{4}{3}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveWeaklyP{r}{4}{1}{\BeginPaCont}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{2}{l2a}{\perp}{pr'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l2a}{\perp}{pr'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (WSkip)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{2}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}.\\\hspace*{1em}\SendUnreliableP{r}{4}{3}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}\dots\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} end
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{2}{l2a}{\perp}{pr'}.\If{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l2a}{\perp}{pr'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

\newcommand{\ABC}[0]{\operatorname{abc}}

$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \SendUnreliableP{r}{4}{3}{l2a}{\ProposalC{\prNumber{5}{6}}{\promValue{\VectorV}}}.end\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{\ProposalC{10}{\ABC} = \perp} \Then{X} \Else{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \ReceiveUnreliableP{r}{4}{3}{l2a}{\perp}{pr'}.\If{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} end\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{\ProposalC{10}{\ABC} = \perp} \Then{X} \Else{\dots}
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} \If{\ProposalC{10}{\ABC} = \perp} \Then{X} \Else{\dots}
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or (
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \\\hspace*{1em}\Or \Mu{X} \If{\greaterEqual{10}{10}} \Then{\update{pr}{pr'}.\update{n}{\Just{10}}.X} \Else{\dots}
)\\
\Or (
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \\\hspace*{1em}\Or \Mu{X} \If{\greaterEqual{10}{10}} \Then{\update{pr}{pr'}.\update{n}{\Just{10}}.X} \Else{\dots}
)\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=Nothing, pr=Nothing
% A2: n=10, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{5}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{5}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{3}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet, USend + UGet, USkip)\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Mu{X} \If{5 = \perp} \Then{\PaCont} \Else{\dots}\\
\Or \Paren{
    \Mu{X} \If{5 = \perp} \Then{\PaCont} \Else{\dots}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \If{\perp = \perp} \Then{\PaCont} \Else{\dots}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Mu{X} \If{\greaterThan{5}{\Nothing}} \Then{\update{n}{5}\dots}\Else{\dots}\\
\Or \Paren{
    \Mu{X} \If{\greaterThan{5}{\Just{10}}} \Then{\dots} \Else{\SendUnreliableP{s}{2}{4}{l1b}{\Nack{10}}.\PaCont}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=5, pr=Nothing
% A2: n=10, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}\dots\\
\Or \Mu{X} \SendUnreliableP{s}{1}{4}{l1b}{\Promise{\Nothing}}.\PaCont\\
\Or \Paren{
    \Mu{X} \SendUnreliableP{s}{2}{4}{l1b}{\Nack{10}}.\PaCont
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet, USend + UGet)\\
\NuChannels \big (
\Mu{X} \If{\True \tOr 1 < 1} \Then{\SendWeaklyP{s}{4}{\Sort{1,2}}{\Restart}{X}} \Else{\dots}\\
\Or \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendWeaklyP{s}{4}{\Sort{1,2}}{\Restart}{X}\\
\Or \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{r}{4}{3}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (WSel + WBran, WSkip)\\
\NuChannels \big (
\Mu{X} X\\
\Or \Mu{X} X\\
\Or \Paren{
    \Mu{X} X
    \Or \Mu{X} X
}\\
\Or \Paren{
    \Mu{X} end
    \Or \Mu{X} X
}\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$=\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l1a}{\prNumber{6}{4}}.\SendUnreliableP{s}{4}{2}{l1a}{\prNumber{6}{4}}\dots\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l1a}{\perp}{n'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l1a}{\perp}{n'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

$\longmapsto (USend + UGet, USend + UGet)\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}.\If{\dots}\\
\Or \Mu{X} \If{15 = \perp} \Then{\PaCont} \Else{\dots}\\
\Or \Paren{
    \Mu{X} \If{15 = \perp} \Then{\PaCont} \Else{\dots}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=5, pr=Nothing
% A2: n=10, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}.\If{\dots}\\
\Or \Mu{X} \If{\greaterThan{15}{\Just{5}}} \Then{\update{n}{15}\dots} \Else{\dots}\\
\Or \Paren{
    \Mu{X} \If{\greaterThan{15}{\Just{10}}} \Then{\update{n}{15}\dots} \Else{\dots}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Mu{X} \ReceiveUnreliableP{s}{1}{4}{l1b}{\perp}{v_1}.\ReceiveUnreliableP{s}{2}{4}{l1b}{\perp}{v_2}.\If{\dots}\\
\Or \Mu{X} \SendUnreliableP{s}{1}{4}{l1b}{\Promise{\Nothing}}.\PaCont\\
\Or \Paren{
    \Mu{X} \SendUnreliableP{s}{2}{4}{l1b}{\Promise{\ProposalC{10}{abc}}}.\PaCont
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$\longmapsto (USend + UGet, USend + UGet)\\
\NuChannels \big (
\Mu{X} \If{\False \tOr 2 < 1} \Then{\dots} \Else{\SendWeaklyP{s}{4}{\Sort{1,2}}{\Accept}{\dots}}\\
\Or \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Mu{X} \SendWeaklyP{s}{4}{\Sort{1,2}}{\Accept}{\dots}\\
\Or \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}\\
\Or \Paren{
    \Mu{X} \ReceiveWeaklyP{s}{4}{1}{\BeginPaCont}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$\longmapsto (WSel + WBran)\\
\NuChannels \big (
\Mu{X} \SendUnreliableP{s}{4}{1}{l2a}{\ProposalC{\prNumber{6}{4}}{\promValue{\VectorV}}}.\\\SendUnreliableP{s}{4}{2}{l2a}{\ProposalC{\prNumber{6}{4}}{\promValue{\VectorV}}}.end\\
\Or \Mu{X} \ReceiveUnreliableP{s}{4}{1}{l2a}{\perp}{pr'}.\If{\dots}\\
\Or \Paren{
    \Mu{X} \ReceiveUnreliableP{s}{4}{2}{l2a}{\perp}{pr'}.\If{\dots}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$\longmapsto (USend + UGet, USend + UGet)\\
\NuChannels \big (
\Mu{X} end\\
\Or \Mu{X} \If{\ProposalC{15}{\ProposalC{15}{abc}} = \perp} \Then{\dots} \Else{\dots}\\
\Or \Paren{
    \Mu{X} \If{\ProposalC{15}{\ProposalC{15}{abc}} = \perp} \Then{\dots} \Else{\dots}
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Nothing
% A2: n=15, pr=Proposal 10 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Or \Mu{X} \If{\greaterEqual{15}{\Just{15}}}\\\hspace*{1em}\Then{\update{pr}{\ProposalC{15}{abc}}.\update{n}{15}.X} \Else{\dots}\\
\Or (
    \Mu{X} \If{\greaterEqual{15}{\Just{15}}}\\\hspace*{1em}\Then{\update{pr}{\ProposalC{15}{abc}}.\update{n}{15}.X} \Else{\dots}
    \Or \Mu{X} X
)\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Proposal 15 abc
% A2: n=15, pr=Proposal 15 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \big (
\Or \Mu{X} X\\
\Or \Paren{
    \Mu{X} X
    \Or \Mu{X} X
}\\
\Or \Mu{X} X\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Proposal 15 abc
% A2: n=15, pr=Proposal 15 abc
% A3: n=10, pr=Proposal 10 abc
$\longmapsto (USkip + WSkip, USkip + WSkip, USkip + WSkip, USkip + WSkip)\\
\NuChannels \big (
\Or \Mu{X} end\\
\Or \Paren{
    \Mu{X} end
    \Or \Mu{X} end
}\\
\Or \Mu{X} end\\
\Or \InnerSessionQueues{s}
\Or \InnerSessionQueues{r}
\Or \OuterSessionQueues
\big )$

% A1: n=15, pr=Proposal 15 abc
% A2: n=15, pr=Proposal 15 abc
% A3: n=10, pr=Proposal 10 abc
$=\\
\NuChannels \Paren{
    \Or \InnerSessionQueues{s}
    \Or \InnerSessionQueues{r}
    \Or \OuterSessionQueues
}$
